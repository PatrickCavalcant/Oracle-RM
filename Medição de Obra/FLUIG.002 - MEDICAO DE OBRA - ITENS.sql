// Itens do Contratos
SELECT 
MITMCNT.IDPRJ AS IDPRJ,
MITMCNT.IDCNT AS IDCNT,
MPDO.PERIODOMED AS PERIODOMED,
MPRJ.ULTIMOCALCULO AS ULTIMOCALCULO,
MPRJ.VALORPROJETO AS VALORPROJETO,
MTRF.CODTRF AS ITEM,
MITMCNT.DESCRICAO AS DESCRICAO,
MTRF.CODUND AS UNIDADE,
MITMCNT.QUANTIDADE AS QUANTIDADE,
MITMCNT.VALORATUAL AS VALORUNIT,
(MITMCNT.VALORATUAL * MITMCNT.QUANTIDADE) AS VALORTOTAL, 
MTRFMED.QUANTIDADEMEDIDA AS QUANTIDADEMEDIDA,
MTRFMED.VALORMEDIDO AS VALORMEDIDO,
(SELECT SUM(A.QUANTIDADEMEDIDA) FROM MTRFMED A WHERE A.IDPRJ = MTRFMED.IDPRJ AND A.IDCNT = MTRFMED.IDCNT AND A.IDITMCNT = MITMCNT.IDITMCNT AND A.PERIODOMED != MTRFMED.PERIODOMED) AS QUANTIDADEANTERIOR,
(SELECT SUM(B.VALORMEDIDO) FROM MTRFMED B WHERE B.IDPRJ = MTRFMED.IDPRJ AND B.IDCNT = MTRFMED.IDCNT AND B.IDITMCNT = MITMCNT.IDITMCNT AND B.PERIODOMED != MTRFMED.PERIODOMED) AS VALORANTERIOR,
(SELECT SUM(A.QUANTIDADEMEDIDA) FROM MTRFMED A WHERE A.IDPRJ = MTRFMED.IDPRJ AND A.IDCNT = MTRFMED.IDCNT AND A.IDITMCNT = MITMCNT.IDITMCNT) AS QUANTIDADEACUMULADA,
(SELECT SUM(B.VALORMEDIDO) FROM MTRFMED B WHERE B.IDPRJ = MTRFMED.IDPRJ AND B.IDCNT = MTRFMED.IDCNT AND B.IDITMCNT = MITMCNT.IDITMCNT) AS VALORACUMULADO
FROM MITMCNT MITMCNT
INNER JOIN MPRJ MPRJ ON	MITMCNT.IDPRJ = MPRJ.IDPRJ
INNER JOIN MPDO MPDO ON	MITMCNT.IDCNT = MPDO.IDCNT AND MITMCNT.IDPRJ = MPDO.IDPRJ
INNER JOIN MTRF MTRF ON MITMCNT.IDTRF = MTRF.IDTRF AND MITMCNT.IDPRJ = MTRF.IDPRJ
LEFT JOIN MTRFMED MTRFMED ON MITMCNT.IDCNT = MTRFMED.IDCNT AND MITMCNT.IDPRJ = MTRFMED.IDPRJ AND MITMCNT.IDITMCNT = MTRFMED.IDITMCNT AND MPDO.PERIODOMED = MTRFMED.PERIODOMED
WHERE
MTRF.ATIVA = 1
AND MPDO.VISIVELPORTAL = 1
AND MPRJ.IDPRJ =:IDPRJ
AND MITMCNT.IDCNT =:IDCNT
AND MPDO.PERIODOMED =:PERIODOMED
ORDER BY MITMCNT.IDCNT, MTRF.CODTRF